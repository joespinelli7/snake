<!DOCTYPE html>
  <head>
  	<title>Snake Game</title>
    <link href="https://fonts.googleapis.com/css?family=Antic+Slab" rel="stylesheet">
  </head>

  <body>
    <div id="score">0</div>

    <canvas id="gameCanvas" width="400" height="400"></canvas>

      <style>
        #gameCanvas {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          border: solid 1px black;
          margin-top: 50px;
        }

        #score {
          text-align: center;
          font-size: 140px;
          font-family: "Antic Slab", serif;
        }
      </style>
  </body>

  <script>
    // Each object represents a segment of the snake
    let snake = [
      {x: 200, y: 200},
      {x: 190, y: 200},
      {x: 180, y: 200},
      {x: 170, y: 200},
      {x: 160, y: 200}
    ];

    // Horizontal velocity
    let dx = 10;
    // Vertical velocity
    let dy = 0;
    // Food x-coordinate
    let foodX;
    // Food y-coordinate
    let foodY;

    // Get the canvas element
    const gameCanvas = document.getElementById("gameCanvas");
    // Return a two dimensional drawing context
    const ctx = gameCanvas.getContext("2d");

    // Start the game
    main();
    // Create the first food location
    createFood();
    // Calling changeDirection whenever a key is pressed
    document.addEventListener("keydown", changeDirection)

    // Main function of the game, called repeatedly (every step/ movement of the snake) to advance the game
    function main() {
      setTimeout(() => {
          // Call clearCanvas to remove previous positions of snake that would leave a trail behind
          clearCanvas();
          drawFood();
          advanceSnake();
          // Always have to call drawSnake after advanceSnake to show snake moving
          drawSnake();
          main();
        }, 100)
    }

    function clearCanvas() {
      //  Select the colour to fill the drawing
      ctx.fillStyle = "white";
      //  Select the colour for the border of the canvas
      ctx.strokeStyle = "black";
      // Draw a "filled" rectangle to cover the entire canvas
      ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
      // Draw a "border" around the entire canvas
      ctx.strokeRect(0, 0, gameCanvas.width, gameCanvas.height);
    }

    // Advances the snake by changing the x-coordinates of its parts according to the horizontal velocity and
    // the y-coordinates of its parts according to the vertical velocity
    function advanceSnake() {
      // Create new head, -y makes snake go up vertically
      const head = {x: snake[0].x + dx, y: snake[0].y + dy};
      // Add new head to beginning of the snake
      snake.unshift(head);

      const didEatFood = snake[0].x === foodX && snake[0].y === foodY;
      if (didEatFood) {
        // If we do eat the food skip removing the last part and just add a new head onto the snake (using unshift above)
        createFood();
      } else {
        // Remove the last segment of the snake
        snake.pop()
      }
      // This correctly shifts all parts of the snake into place
    }

    // Generates a random number that is a multiple of 10 given a minumum and a maximum number
    // (param) min: The minimum number the random number can be (0)
    // (param) max:  The maximum number the random number can be (390)
    function randomNumber(min, max) {
      return Math.round((Math.random() * (max - min) + min) / 10) * 10;
    }

    // Draw the food on the canvas
    function drawFood() {
      ctx.fillStyle = "red";
      ctx.strokeStyle = "darkred";
      ctx.fillRect(foodX, foodY, 10, 10);
      ctx.strokeRect(foodX, foodY, 10, 10)
    }

    function createFood() {
      // Generate a random number for the x and y coordinates of the food
      foodX = randomNumber(0, gameCanvas.width - 10);
      foodY = randomNumber(0, gameCanvas.height - 10);

      // If the new food location is where the snake currently is, generate a new food location
      snake.forEach(snakePart => {
        const foodIsOnSnake = snakePart.x == foodX && snakePart.y == foodY;
        // Check if food generated is on the snake and if true create a new food location
        if (foodIsOnSnake) {
          console.log('here')
          createFood();
        }
      })
    }

    // Draws the snake on the canvas
    function drawSnake() {
      // snake has x and y coordinates as created in the variable
      snake.forEach(snakePart => drawSnakePart(snakePart));
    }

    // Draws a part of the snake on the canvas
    // @param { object } snakePart - The coordinates where the part should be drawn
    function drawSnakePart(snakePart) {
      // https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Applying_styles_and_colors
      ctx.fillStyle = "lightgreen";
      ctx.strokeStyle = "black";
      // (x coordinate, y coordinate, width, height)
      // Fills rectangle
      ctx.fillRect(snakePart.x, snakePart.y, 10, 10);
      // Draws actual rectangle
      ctx.strokeRect(snakePart.x, snakePart.y, 10, 10);
    }

    // Changes the vertical and horizontal velocity of the snake according to the key that was pressed.
    // The direction cannot be switched to the opposite direction, to prevent the snake from reversing.
    // For example if the the direction is 'right' it cannot become 'left'.
    // (param) event: The keydown event
    function changeDirection(event) {
      const leftKey = 37;
      const rightKey = 39;
      const upKey = 38;
      const downKey = 40;

      const keyPressed = event.keyCode;
      const goingUp = dy === -10;
      const goingDown = dy === 10;
      const goingRight = dx === 10;
      const goingLeft = dx === -10;

      if (keyPressed === leftKey && !goingRight) {
        dx = -10;
        dy = 0;
      } else if (keyPressed === rightKey && !goingLeft) {
        dx = 10;
        dy = 0;
      } else if (keyPressed === upKey && !goingDown) {
        dx = 0;
        dy = -10;
      } else if (keyPressed === downKey && !goingUp) {
        dx = 0;
        dy = 10;
      }
    }
  </script>
</html>
